rails new devise_app -d postgresql    

rails g model User username first_name last_name

rake db:drop db:create db:migrate


"references" = tells the model to reference the model "users" creates belongs_to :users for you
rails g scaffold Images image_url:text caption:text user:references

gem 'devise' in Gemfile
rails g devise:install
Follow the manual setup instructions


#### This will set up the settings for authentication for the model User.
rails g devise user

#### Will tell you the url of each page setup in the system.
rails/routes


### Put this in application.html.erb
### This will put signed in user at top
### Look at routes to see what path and what method to use
<% if user_signed_in? %>
Hola <%= link_to current_user.email. edit_user_registration_path%>
<%= link_to "Logout", destroy_user_session_path, method: :delete %>
<% else %>
<%= link_to "Login", new_user_session_path %> | <%= link_to "Signup", new_user_registration_path %>
<% end %>


###This will show devise files
rails g devise:views

Add the fields for username, first_name, last_name



###Devise have to use STRONG paramaters
###Put it in APPLICATION controller. All controllers inherit from ApplicationController

before_filter :configure_permitted_parameters, if: :devise_controller?
  protected

  def configure_permitted_parameters
    devise_parameter_sanitizer.for(:sign_up) do |u|
      u.permit(:name, :heard_how,
        :email, :password, :password_confirmation)
    end
    devise_parameter_sanitizer.for(:account_update) do |u|
      u.permit(:name,
        :email, :password, :password_confirmation, :current_password)
    end
  end

##ADD if user_signed_in? to hide to link unless it's signed in.
  <%= link_to 'New Image', new_image_path if user_signed_in? %>



##ADD before_action :authenticate_user!, except: [:index, :show]
to ImagesController to authenticate all except index and show



## ADD this to image create
@image = current_user.images.new(image_params)
because they are associated

Remove user_id from strong params of ImagesController